<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Legislative Behavior</title>
    <script src="https://d3js.org/d3.v3.js"></script>
    
     <style>
        body{
            background: #eee;
        }
        .axis path, .axis line{
            fill:none;
            stroke:black;
            shape-rendering:auto;
        }
        .axis text{
            font-size: 12px;
            fill:blue;
        }
    </style>
    
</head>
<body>

<script>
    var w = 1250;
    var h = 620; 
    var padding = 80; 
    var letterList = ["國民黨","民進黨","親民黨","台聯","無黨團結聯盟"];
    
    svg(); 
    
    d3.csv("D3-legislation.csv", function(dataSet){
           
           bind(dataSet);
           render(dataSet);
            
        });
        
        
    function svg(){
           d3.select("body").append("svg").attr({
           width:w,
           height:h
           });
            
    d3.select("svg").append("g").append("rect").attr({
             width: "100%",
             height: "100%",
             fill: "white"
        });
        }
    
    function bind(dataSet){
            var selection = d3.select("svg")
                              .selectAll("circle")
                              .data(dataSet);
            
            selection.enter().append("circle");
            selection.exit().remove();
        }
        
        function render(dataSet){
            var xScale = d3.scale.linear()
                    .domain([0,d3.max(dataSet,function(d){
                        return +d.news;
                    })])
                    .range([padding,w-padding]);
                           
            var yScale = d3.scale.linear()
                    .domain([10,d3.max(dataSet,function(d){
                        return +d.signnum;
                    })])
                    .range([h-padding,padding]);
            
            var rScale = d3.scale.linear()
                    .domain([d3.min(dataSet,function(d){
                        return +d.pronum;
                    }),d3.max(dataSet,function(d){
                        return +d.pronum;
                    })])
                    .range([2,6]);
            
           var fScale = d3.scale.category10();

    
            var xAxis= d3.svg.axis()
                      .scale(xScale)
                      .orient("bottom");
                           
            var yAxis= d3.svg.axis()
                      .scale(yScale)
                      .orient("left");

         d3.selectAll("circle")
              .attr({
                cx:function(d){
                    return xScale(d.news);
                },
                cy:function(d){
                    return yScale(d.signnum);
                },
                r:function(d){
                    return rScale(+d.pronum);
                },
                fill:function(d){
                    return fScale(letterList.indexOf(d.firstpar));
                }})
              .append("title").text(function(d){
                  return d.name+"\r\n"+d.number+"\r\n"+d.firstpro;
                });
         
            
       d3.select("svg")
             .append("g")
             .attr("class","axis")
             .attr("transform","translate(0,"+(h-padding+10)+")")
             .call(xAxis)
             .append("text")
             .attr("x", 1190)
             .text("新聞筆數");
    
       d3.select("svg")
             .append("g")
             .attr("class","axis")
             .attr("transform","translate("+(padding-15)+",0)")
             .call(yAxis)
             .append("text")
             .attr("x", -50)
             .attr("y", 50)
             .text("法律提案之連署人數");
             
        }
            
          function btnList(dataSet){
           var partyArr = dataSet.map(function(d){
               return d.firstpar;
           })
           
           var uniqueparty = unique(partyArr);
           var selection = d3.select("body").selectAll("div").data(uniqueparty);
           selection.enter().append("div");
           selection.exit().remove();
              
           d3.selectAll("div").text(function(d){
               return d
           })}

           function unique(partyArr){
           var n = [];
               
           for (var i=0; i<partyArr.length;i++){
                if(n.indexOf(partyArr[i])===-1){
                   n.push(partyArr[i]);
                   return n;}}}
        
    
    </script>
    
</body>
</html>